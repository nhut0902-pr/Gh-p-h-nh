/* --- Cài đặt chung & Font --- */
:root {
    --bg-start: #4c3d9a;
    --bg-end: #2c2162;
    --grid-bg: rgba(0, 0, 0, 0.2);
    --grid-cell-bg: rgba(0, 0, 0, 0.25);
    --blue-block: #3b82f6; --blue-shadow: #1e40af;
    --orange-block: #f97316; --orange-shadow: #9a3412;
    --pink-block: #ec4899; --pink-shadow: #9d174d;
    --yellow-block: #eab308; --yellow-shadow: #854d0e;
    --text-color: #ffffff;
    --modal-bg: rgba(0, 0, 0, 0.7);
    --success-color: #22c55e;
    --fail-color: #ef4444;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
    color: var(--text-color);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow: hidden;
    -webkit-user-select: none; user-select: none;
    -webkit-touch-callout: none;
}

/* Thêm lớp khi powerup active */
body.hammer-active { cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' fill='white' stroke='black' stroke-width='2'%3E%3Cpath d='M14.5 2.5l-5 5L5 12l-2.5 2.5 5 5L10 22l4.5-4.5 5-5-2.5-2.5-5-5z'/%3E%3Cpath d='M12 5l-5 5'/%3E%3C/svg%3E") 16 16, crosshair; }
body.bomb-active { cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' fill='white' stroke='black' stroke-width='1.5'%3E%3Ccircle cx='12' cy='12' r='8'/%3E%3Cpath d='M12 2v4M12 18v4M22 12h-4M6 12H2'/%3E%3C/svg%3E") 16 16, crosshair; }


#game-container { display: flex; flex-direction: column; align-items: center; gap: 15px; width: 100%; max-width: 420px; padding: 15px; }

/* --- Header --- */
.game-header { display: flex; justify-content: center; align-items: center; width: 100%; gap: 10px; }
.info-panel { background: var(--grid-bg); padding: 8px 15px; border-radius: 20px; font-weight: 700; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
.icon { width: 22px; height: 22px; background-size: contain; background-position: center; background-repeat: no-repeat; }
.coin-icon { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23eab308'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='central' text-anchor='middle' font-size='14' fill='black' font-weight='bold'%3E$%3C/text%3E%3C/svg%3E"); }
.crate-icon { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23a16207' d='M10 10 H 90 V 90 H 10 Z'/%3E%3Cpath fill='none' stroke='%23ca8a04' stroke-width='8' d='M20 80 L 80 20 M20 20 L 80 80'/%3E%3C/svg%3E"); }

/* --- Lưới game & Ô --- */
#game-board-wrapper { width: 100%; aspect-ratio: 1 / 1; padding: 8px; background: var(--grid-bg); border-radius: 12px; }
#game-board { display: grid; grid-template-columns: repeat(9, 1fr); grid-template-rows: repeat(9, 1fr); width: 100%; height: 100%; gap: 4px; }
.grid-cell { background-color: var(--grid-cell-bg); border-radius: 4px; position: relative; transition: background-color 0.2s; }
.grid-cell.bomb-preview { background-color: var(--fail-color); } /* Hiệu ứng cho bom */

.block { position: absolute; width: 100%; height: 100%; border-radius: 4px; transition: transform 0.2s ease; box-shadow: inset 0 3px rgba(255,255,255,0.3), inset 0 -3px rgba(0,0,0,0.3); }
/* Hiệu ứng Phá Ô Mới */
.block.clearing { animation: explode-animation 0.5s ease-out forwards; }
@keyframes explode-animation {
    0% { transform: scale(1) rotate(0); opacity: 1; }
    100% { transform: scale(1.5) rotate(90deg); opacity: 0; }
}

.block-blue { background-color: var(--blue-block); }
.block-orange { background-color: var(--orange-block); }
.block-pink { background-color: var(--pink-block); }
.block-yellow { background-color: var(--yellow-block); }
.block-crate { background-color: #a16207; position: relative; overflow: hidden; }
.block-crate::before, .block-crate::after { content: ''; position: absolute; background-color: #ca8a04; box-shadow: 0 1px 2px rgba(0,0,0,0.4); }
.block-crate::before { width: 141.42%; height: 20%; top: 40%; left: -20.71%; transform: rotate(45deg); }
.block-crate::after { width: 141.42%; height: 20%; top: 40%; left: -20.71%; transform: rotate(-45deg); }


/* --- Thanh vật phẩm và Nút hành động --- */
.action-bar { display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 0 10px; }
#power-up-bar { display: flex; gap: 10px; flex-grow: 1; }
.power-up-btn { width: 50px; height: 50px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.5); background-color: var(--grid-bg); cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
.power-up-btn:hover { transform: translateY(-2px); border-color: white; }
.power-up-btn.active { border-color: var(--success-color); box-shadow: 0 0 10px var(--success-color); }
.power-up-icon { width: 60%; height: 60%; background-size: contain; background-repeat: no-repeat; background-position: center; }
.power-up-count { position: absolute; bottom: -5px; right: -5px; background-color: var(--fail-color); color: white; border-radius: 50%; width: 22px; height: 22px; font-size: 0.8rem; font-weight: 700; display: flex; align-items: center; justify-content: center; border: 2px solid white; }
.action-button { width: 50px; height: 50px; border: none; border-radius: 10px; background-color: var(--grid-bg); cursor: pointer; background-size: 55%; background-repeat: no-repeat; background-position: center; transition: all 0.2s; margin-left: 10px; }
.action-button:hover { background-color: #4a3d9a; }
.store-icon { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3E%3Cpath d='M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6-2c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2zm6 16H6V8h2v2c0 .55.45 1 1 1s1-.45 1-1V8h4v2c0 .55.45 1 1 1s1-.45 1-1V8h2v12z'/%3E%3C/svg%3E"); }
.settings-icon { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3E%3Cpath d='M19.479 10.092c.062-.375.094-.758.094-1.146s-.031-.771-.094-1.146l2.115-1.652a.5.5 0 00.094-.531l-2.125-3.682a.5.5 0 00-.531-.156l-2.583 1.042a5.95 5.95 0 00-1.448-.833l-.365-2.781a.5.5 0 00-.438-.375h-4.25a.5.5 0 00-.438.375l-.365 2.781c-.521.218-1 .5-1.448.833l-2.583-1.042a.5.5 0 00-.531.156L2.32 8.36a.5.5 0 00.094.531l2.115 1.652c-.062.375-.094.771-.094 1.146s.032.771.094 1.146l-2.115 1.652a.5.5 0 00-.094.531l2.125 3.682a.5.5 0 00.531.156l2.583 1.042a5.95 5.95 0 001.448.833l.365 2.781a.5.5 0 00.438.375h4.25a.5.5 0 00.438.375l.365-2.781c.521-.218 1-.5 1.448-.833l2.583 1.042a.5.5 0 00.531-.156l2.125-3.682a.5.5 0 00-.094-.531l-2.115-1.652zM12 15.5a3.5 3.5 0 110-7 3.5 3.5 0 010 7z'/%3E%3C/svg%3E"); }

/* --- Khu vực chứa các khối --- */
#piece-container { display: flex; justify-content: space-around; align-items: flex-end; width: 100%; height: 120px; padding: 10px 0; }
.piece { display: grid; position: relative; cursor: grab; transition: transform 0.1s ease-out; }
.piece:active { cursor: grabbing; }
.piece.dragging { opacity: 1; z-index: 1000; position: absolute; pointer-events: none; transition: all 0.1s ease; transform-origin: center center; }
.piece.dragging .block { box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
.piece.dragging.can-place { filter: drop-shadow(0 0 10px var(--success-color)); }
.piece.dragging.cannot-place { filter: drop-shadow(0 0 10px var(--fail-color)); opacity: 0.7 !important; }
.piece-cell { width: 30px; height: 30px; }
.piece .block { transform: scale(1); box-shadow: none; /* Bỏ shadow 3D khi là piece nhỏ */ }

/* --- Modals & Cửa hàng --- */
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--modal-bg); display: flex; justify-content: center; align-items: center; z-index: 2000; transition: opacity 0.3s; }
.modal-overlay.hidden { opacity: 0; pointer-events: none; }
.modal-content { background: linear-gradient(var(--bg-end), var(--bg-start)); padding: 30px; border-radius: 15px; border: 2px solid rgba(255,255,255,0.2); text-align: center; width: 90%; max-width: 450px; animation: modal-appear 0.3s ease-out; }
@keyframes modal-appear { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.store-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; margin-bottom: 20px; max-height: 50vh; overflow-y: auto; padding: 10px; }
.store-item { background: var(--grid-cell-bg); padding: 15px 10px; border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: space-between; gap: 8px; }
.store-item:not(.disabled):hover { background-color: var(--bg-start); transform: translateY(-3px); }
.store-item.disabled { opacity: 0.4; cursor: not-allowed; }
.item-icon { width: 40px; height: 40px; background-size: contain; background-repeat: no-repeat; background-position: center; }
.item-details { display: flex; flex-direction: column; gap: 5px; text-align: center; }
.item-name { font-size: 0.9rem; font-weight: 700; }
.item-cost { display: flex; align-items: center; font-weight: 600; font-size: 0.9rem; color: var(--yellow-block); }
.item-cost .icon { width: 16px; height: 16px; margin-right: 4px; }
.modal-content button { padding: 10px 25px; border-radius: 8px; border: none; background-color: var(--blue-block); color: white; font-weight: 700; cursor: pointer; transition: all 0.2s; }
.close-modal-button { background-color: var(--pink-block); }
